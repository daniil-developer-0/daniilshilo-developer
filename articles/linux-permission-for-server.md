# Правильные права доступа к папке для веб-сайта на сервере Linux
*Перевод и дополнение статьи https://www.internalpointers.com/post/right-folder-permission-website*

Веб-сайт хранится на сервере под ОС Linux, например на Ubuntu, и управляется веб-сервером, таким как Apache или Nginx. Вы являетесь владельцем проекта и единственным пользователем, ответственным за его поддержку.

Сайт состоит из статического контента, такого как CSS, изображения, HTML-страницы, а также некоторого динамического контента, генерируемого веб-сервером на лету - например, скрипта PHP (или Node.js), который управляет загрузкой файлов. Таким образом, веб-серверу необходимо читать статический контент, чтобы отображать его для публики, а также записывать данные в папку сайта в соответствии с инструкциями файлов сценария.

Наконец, давайте представим, что вашего пользователя зовут john, папка веб-сайта находится в /var/www/my-website.com/, а веб-сервер принадлежит группе пользователей www-data.

# Установка прав папки сервера
Ваш пользователь будет владельцем каталога веб-сайта и будет иметь полные права на чтение, запись и выполнение. Веб-сервер будет владельцем группы и изначально будет иметь права на чтение и выполнение, за исключением некоторых папок, в которых он будет иметь доступ на запись. Больше никому не будет позволено возиться со всем каталогом веб-сайта.

Для начала войдите на свой сервер и выполните четыре команды ниже:

## 1. Установка пользователя как владельца директории
```bash
chown -R john /var/www/my-website.com/
```
Эта команда устанавливает john как владельца каждого файла и папки внутри каталога (флаг -R означает рекурсивность).

## 2. Установка группы сервера как группового владельца директории
```bash
chgrp -R www-data /var/www/my-website.com/
```
Эта команда устанавливает www-data в качестве владельца группы для каждого файла и папки внутри каталога. Также рекурсивно с помощью флага -R, как указано выше.

> На самом деле мы сразу можем установить и пользователя и группу рекурсивно, с помощью данной команды:
> ```bash
chown john:www-data /var/www/my-website.com
> ```

## 3. Права «750» на всё
```bash
chmod -R 750 /var/www/my-website.com/
```
Третья команда устанавливает права: чтение, запись и выполнение (7) для владельца (т.е. вас), чтение и выполнение (5) для владельца группы (т.е. веб-сервер), нулевые права (0) для других. И снова это делается рекурсивно для каждого файла и папки в каталоге (с помощью флага -R).

## 4. Новые файлы и директории наследуют групповое владение от родительской директории
```bash
chmod g+s /var/www/my-website.com/
```
Последняя команда заставляет все файлы корневой папки, созданные в каталоге, автоматически наследовать групповое владение родительской папки, то есть вашим веб-сервером. Флаг -s — это специальный режим, представляющий [setuid/setgid](https://vk.com/away.php?to=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FChmod%23Special_modes&utf=1). Проще говоря, новые файлы и каталоги, созданные веб-сервером, будут иметь такое же групповое владение папкой my-website.com/, которое мы установили на www-data с помощью второй команды.

## Частный случай случай, если веб-серверу нужны права на запись
Если у вас есть папки, которые должны быть доступны для записи веб-серверу, вы можете просто изменить значения прав для владельца группы, чтобы www-data имели доступ на запись. Выполните эту команду для каждой доступной для записи папки:

```bash
chmod g+w /var/www/my-website.com/<writable-folder>
```

В целях безопасности применяйте это только в случае необходимости, а не для всего каталога веб-сайта.

# Дополнение
## Что означает «750»?
750 — настройка прав доступа. Дело в том, что при выводе директории с помощью команды (алиаса, на самом деле) ll (алиас команды ls -la), мы будем наблюдать следующую картину:

![ls output](/assets/screenshots/linux-permission-server-1.jpg)

Слева можно увидеть колонку, в которой написаны значения по типу:

```bash
drwxr-xr-x
```

Это и есть права доступа. Первая буква говорит нам о том, чем именно является сущность:

* «-» — файл
* «d» — директория
* «l» — ссылка
Вторая колонка «rwx» говорит нам о правах владельца. В данном случае у владельца есть права на чтение (r — read), запись (w — write), выполнение (x — execution).

Третья колонка «rwx» сообщает нам о правах группы. В данном случае пользователи группы могут читать и выполнять (там где должна быть w — «-», значит прав не было предоставлено).

Четвертая колонка говорит нам о правах всех остальных пользователей. Ситуация с правами аналогична третьей колонке.

Добавить права можно с помощью операндов:

* «+» — добавить права
* «-» — отнять права
* «=» — установить только перечисленные права

Например:

```bash
sudo chmod +rw ./директория # Установить права на чтение и запись
sudo chmod -x ./директория # Убрать права на выполнение
sudo chmod =x ./директория # Убрать все права и добавить права на выполнение
```

## Численная запись

Так что же всё-таки значит «750»? Дело в том, что все права (rwx) можно представить в виде суммы степеней двойки, начиная с 0:

* ничего — 0
* x — 1 (2 в нулевой степени)
* w — 2 (2 в первой степени)
* r — 4 (2 во второй степени)

При сумме данные значения будут давать нам необходимые права:

`+rw` — аналогично 4 + 2 = 6

`+x` — аналогично 1

`+rwx` — аналогично 4 + 2 + 1 = 7

Соответственно, чтобы дать все права всем (и пользователю, и группе, и остальным пользователям) нужно ввести 777, чтобы убрать все права — 000, чтобы дать права только на чтение — 444.

«750» говорит нам о том, что пользователю даются все привелегии (rwx — 4 + 2 + 1 = 7), группе даются права на чтение и выполнение (r-x — 4 + 0 + 1 = 5), а всем остальным пользователям права «режутся» — («---» — 0 + 0 + 0 = 0).

Запись 750 эквивалентна «rwxr-x---».

## Право «выполнения» директории?

Вы уже наверняка заметили, что мы присваивали директориям право на выполнение, но что это значит? Сейчас разберёмся.

* Если у вас есть разрешение на чтение для каталога, вы можете вывести список содержимого каталогов (с помощью ls), и вообще у программы или пользователя есть доступ на чтение)
* Если у вас есть разрешение на запись в каталог, вы можете создавать новые записи (файлы / папки).
* Если у вас есть разрешение на выполнение для каталога, вы можете изменить chdir в этой директории. Проще говоря с правом на выполнение директории вы можете администрировать данную директорию.